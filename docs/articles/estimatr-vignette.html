<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>estimatr: fast estimators for social scientists • estimatr</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">estimatr</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/estimatr-vignette.html">Getting Started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Packages
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="http://declaredesign.org">DeclareDesign</a>
    </li>
    <li>
      <a href="http://randomizr.declaredesign.org">randomizr</a>
    </li>
    <li>
      <a href="http://fabricatr.declaredesign.org">fabricatr</a>
    </li>
    <li>
      <a href="http://estimatr.declaredesign.org">estimatr</a>
    </li>
  </ul>
</li>
<li>
  <a href="http://discuss.declaredesign.org">Discussion Board</a>
</li>
<li>
  <a href="http://declaredesign.org">DeclareDesign home</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/DeclareDesign/estimatr">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>estimatr: fast estimators for social scientists</h1>
                        <h4 class="author">Luke Sonnet</h4>
            
          </div>

    
    
<div class="contents">
<p><strong>estimatr</strong> is a package in R dedicated to providing fast estimators for social scientists. Estimators are statistical methods for estimating quantities of interest like treatment effects or regression parameters. Many of the estimators included with the R programming language or popular R packages are slow and have default settings that lead to statistically inappropriate estimates. Certain estimators that reflect cutting-edge advances in statistics are not yet implemented in R packages for convenient use. <strong>estimatr</strong> is designed to solve these problems.</p>
<div id="estimators" class="section level1">
<h1 class="hasAnchor">
<a href="#estimators" class="anchor"></a>Estimators</h1>
<p>The current estimators we provide are:</p>
<ul>
<li>
<a href="#lm_robust"><code><a href="../reference/lm_robust.html">lm_robust()</a></code></a> - for fitting linear models with heteroskedasticity/cluster robust standard errors</li>
<li>
<a href="#lm_lin"><code><a href="../reference/lm_lin.html">lm_lin()</a></code></a> - a wrapper for <code><a href="../reference/lm_robust.html">lm_robust()</a></code> to simplify interacting centered pre-treatment covariates with a treatment variable</li>
<li>
<a href="#difference_in_means"><code><a href="../reference/difference_in_means.html">difference_in_means()</a></code></a> - for estimating differences in means with appropriate standard errors for simple, cluster randomized, block randomized, matched-pair designs and more</li>
<li>
<a href="#horvitz_thompson"><code><a href="../reference/horvitz_thompson.html">horvitz_thompson()</a></code></a> - for estimating average treatment effects taking into consideration treatment probabilities or sampling probabilities for simple and cluster randomized designs</li>
</ul>
<p>To demonstrate basic usage of each of the estimators, I first create some sample data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(estimatr)
<span class="co"># Example dataset to be used throughout built using fabricatr and randomizr</span>
dat &lt;-<span class="st"> </span>fabricatr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/fabricatr/topics/fabricate">fabricate</a></span>(
  <span class="dt">N =</span> <span class="dv">100</span>,                       <span class="co"># sample size</span>
  <span class="dt">x =</span> <span class="kw">runif</span>(N, <span class="dv">0</span>, <span class="dv">1</span>),            <span class="co"># pre-treatment covariate</span>
  <span class="dt">y0 =</span> <span class="kw">rnorm</span>(N, <span class="dt">mean =</span> x),       <span class="co"># control potential outcome</span>
  <span class="dt">y1 =</span> y0 <span class="op">+</span><span class="st"> </span><span class="fl">0.35</span>,                <span class="co"># treatment potential outcome</span>
  <span class="dt">z =</span> randomizr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/randomizr/topics/complete_ra">complete_ra</a></span>(N), <span class="co"># complete random assignment to treatment</span>
  <span class="dt">y =</span> <span class="kw">ifelse</span>(z, y1, y0),         <span class="co"># observed outcome</span>
  
  <span class="co"># We will also consider clustered data</span>
  <span class="dt">clust =</span> <span class="kw">sample</span>(<span class="kw">rep</span>(letters[<span class="dv">1</span><span class="op">:</span><span class="dv">20</span>], <span class="dt">each =</span> <span class="dv">5</span>)),
  <span class="dt">z_clust =</span> randomizr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/randomizr/topics/cluster_ra">cluster_ra</a></span>(clust),
  <span class="dt">y_clust =</span> <span class="kw">ifelse</span>(z_clust, y1, y0)
)

<span class="kw">head</span>(dat)</code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">ID</th>
<th align="right">x</th>
<th align="right">y0</th>
<th align="right">y1</th>
<th align="right">z</th>
<th align="right">y</th>
<th align="left">clust</th>
<th align="right">z_clust</th>
<th align="right">y_clust</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">001</td>
<td align="right">0.91</td>
<td align="right">1.24</td>
<td align="right">1.6</td>
<td align="right">0</td>
<td align="right">1.24</td>
<td align="left">k</td>
<td align="right">1</td>
<td align="right">1.59</td>
</tr>
<tr class="even">
<td align="left">002</td>
<td align="right">0.94</td>
<td align="right">0.15</td>
<td align="right">0.5</td>
<td align="right">0</td>
<td align="right">0.15</td>
<td align="left">m</td>
<td align="right">0</td>
<td align="right">0.15</td>
</tr>
<tr class="odd">
<td align="left">003</td>
<td align="right">0.29</td>
<td align="right">1.86</td>
<td align="right">2.2</td>
<td align="right">0</td>
<td align="right">1.86</td>
<td align="left">i</td>
<td align="right">0</td>
<td align="right">1.86</td>
</tr>
<tr class="even">
<td align="left">004</td>
<td align="right">0.83</td>
<td align="right">1.47</td>
<td align="right">1.8</td>
<td align="right">1</td>
<td align="right">1.82</td>
<td align="left">r</td>
<td align="right">1</td>
<td align="right">1.82</td>
</tr>
<tr class="odd">
<td align="left">005</td>
<td align="right">0.64</td>
<td align="right">0.73</td>
<td align="right">1.1</td>
<td align="right">1</td>
<td align="right">1.08</td>
<td align="left">c</td>
<td align="right">0</td>
<td align="right">0.73</td>
</tr>
<tr class="even">
<td align="left">006</td>
<td align="right">0.52</td>
<td align="right">0.80</td>
<td align="right">1.1</td>
<td align="right">0</td>
<td align="right">0.80</td>
<td align="left">s</td>
<td align="right">0</td>
<td align="right">0.80</td>
</tr>
</tbody>
</table>
<p>Results presented in this vignette are rounded to two digits for visual display.</p>
<div id="lm_robust" class="section level2">
<h2 class="hasAnchor">
<a href="#lm_robust" class="anchor"></a><code>lm_robust</code>
</h2>
<p>The <code>estimatr</code> package provides a function to quickly fit linear models with the most common variance estimators and degrees of freedom corrections used in social science. You can easily return heteroskedastic standard errors, clustered standard errors, and classical standard errors.</p>
<p>Usage largely mimics <code>lm()</code>, although it defaults to using Eicker-Huber-White robust standard errors, specifically ‘HC2’ standard errors:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/lm_robust.html">lm_robust</a></span>(y <span class="op">~</span><span class="st"> </span>z <span class="op">+</span><span class="st"> </span>x, <span class="dt">data =</span> dat)</code></pre></div>
<p>It is straightforward to do cluster-robust inference, by passing the name of your cluster variable to the <code>clusters =</code> argument. Note that <code><a href="../reference/lm_robust.html">lm_robust()</a></code> is much quicker if your cluster variable is a factor!</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/lm_robust.html">lm_robust</a></span>(y_clust <span class="op">~</span><span class="st"> </span>z_clust <span class="op">+</span><span class="st"> </span>x, 
          <span class="dt">data =</span> dat, 
          <span class="dt">clusters =</span> clust)</code></pre></div>
<p>The default variance estimator with clusters is dubbed ‘CR2’ because it is analogous to ‘HC2’ for the clustered case, and utilizes recent advances proposed by <span class="citation">(Pustejovsky and Tipton <a href="#ref-pustejovskytipton2016">2016</a>)</span> to correct hypotheses tests for small samples and work with commonly specified fixed effects and weights.</p>
<p>Researchers can also replicate Stata’s clustered standard errors by using the <code>se_type =</code> argument:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/lm_robust.html">lm_robust</a></span>(y_clust <span class="op">~</span><span class="st"> </span>z_clust <span class="op">+</span><span class="st"> </span>x, 
          <span class="dt">data =</span> dat, 
          <span class="dt">clusters =</span> clust, 
          <span class="dt">se_type =</span> <span class="st">'stata'</span>)</code></pre></div>
</div>
<div id="lm_lin" class="section level2">
<h2 class="hasAnchor">
<a href="#lm_lin" class="anchor"></a><code>lm_lin</code>
</h2>
<p>Following the critique by <span class="citation">(Freedman <a href="#ref-freedman2008">2008</a>)</span> that pre-treatment covariate adjustment biases estimates of average treatment effects, <span class="citation">(Lin and others <a href="#ref-lin2013">2013</a>)</span> proposed an alternative estimator that would reduce this bias and improve precision. The <span class="citation">(Lin and others <a href="#ref-lin2013">2013</a>)</span> estimator suggests centering all pre-treatment covariates and interacting them with the treatment variable. To facilitate this, we provide a wrapper that can do that process for you.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/lm_lin.html">lm_lin</a></span>(y <span class="op">~</span><span class="st"> </span>z, 
       <span class="dt">covariates =</span> <span class="op">~</span><span class="st"> </span>x, 
       <span class="dt">data =</span> dat)</code></pre></div>
<p>Furthermore, it is just a wrapper for <code><a href="../reference/lm_robust.html">lm_robust()</a></code>, so all arguments that work for <code><a href="../reference/lm_robust.html">lm_robust()</a></code> work here.</p>
</div>
<div id="difference_in_means" class="section level2">
<h2 class="hasAnchor">
<a href="#difference_in_means" class="anchor"></a><code>difference_in_means</code>
</h2>
<p>While estimating differences in means may seem straightforward, we provide a function that appropriately adjusts estimates for blocking and clustering to match the current state of knowledge in social science methodology. Usage is similar to usage in regression functions.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Simple version</span>
<span class="kw"><a href="../reference/difference_in_means.html">difference_in_means</a></span>(y <span class="op">~</span><span class="st"> </span>z, 
                    <span class="dt">data =</span> dat)
<span class="co"># Clustered version</span>
<span class="kw"><a href="../reference/difference_in_means.html">difference_in_means</a></span>(y_clust <span class="op">~</span><span class="st"> </span>z_clust, 
                    <span class="dt">data =</span> dat, 
                    <span class="dt">clusters =</span> clust)</code></pre></div>
</div>
<div id="horvitz_thompson" class="section level2">
<h2 class="hasAnchor">
<a href="#horvitz_thompson" class="anchor"></a><code>horvitz_thompson</code>
</h2>
<p>Horvitz-Thompson estimators are useful when estimating treatment effects without bias when there is a clustered design with unequal size clusters or when the treatment assignment process is arbitrarily complex. Horvitz-Thompson estimators require information about the treatment (and control) probabilities for each unit, and the joint treatment and control probabilities of every pair of units. For simpler designs, passing your randomization scheme using <code><a href="http://www.rdocumentation.org/packages/randomizr/topics/declare_ra">randomizr::declare_ra()</a></code> is the easiest path forward.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Complete random assignment declaration</span>
crs_decl &lt;-<span class="st"> </span>randomizr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/randomizr/topics/declare_ra">declare_ra</a></span>(<span class="dt">N =</span> <span class="kw">nrow</span>(dat), 
                                  <span class="dt">prob =</span> <span class="fl">0.5</span>, 
                                  <span class="dt">simple =</span> <span class="ot">FALSE</span>)
<span class="kw"><a href="../reference/horvitz_thompson.html">horvitz_thompson</a></span>(y <span class="op">~</span><span class="st"> </span>z, 
                 <span class="dt">data =</span> dat, 
                 <span class="dt">declaration =</span> crs_decl)

<span class="co"># Clustered random assignment declaration</span>
crs_clust_decl &lt;-<span class="st"> </span>randomizr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/randomizr/topics/declare_ra">declare_ra</a></span>(
  <span class="dt">N =</span> <span class="kw">nrow</span>(dat), 
  <span class="dt">clust_var =</span> dat<span class="op">$</span>clust, 
  <span class="dt">prob =</span> <span class="fl">0.5</span>, 
  <span class="dt">simple =</span> <span class="ot">FALSE</span>
)
<span class="kw"><a href="../reference/horvitz_thompson.html">horvitz_thompson</a></span>(y_clust <span class="op">~</span><span class="st"> </span>z_clust, 
                 <span class="dt">data =</span> dat, 
                 <span class="dt">declaration =</span> crs_clust_decl)</code></pre></div>
<p>There are two main variance estimators we provide, a conservative estimator using Young’s inequality (<code>se_type = "youngs"</code>), described by <span class="citation">(Aronow and Middleton <a href="#ref-aronowmiddleton2013">2013</a>)</span>, and an estimator that assumes constant treatment effects (<code>se_type = "constant"</code>). The default is the conservative estimator.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/horvitz_thompson.html">horvitz_thompson</a></span>(
  y_clust <span class="op">~</span><span class="st"> </span>z_clust, 
  <span class="dt">data =</span> dat, 
  <span class="dt">declaration =</span> crs_clust_decl, 
  <span class="dt">se_type =</span> <span class="st">"constant"</span>
)</code></pre></div>
<p>You can also build the condition probability matrix (<code>condition_prob_mat =</code>) that <code><a href="../reference/horvitz_thompson.html">horvitz_thompson()</a></code> needs yourself. This matrix is an 2N by 2N matrix, where the first N rows and N columns (the upper-left corner) are the joint probability of each unit being in the control condition with every other unit being in the control condition. The upper right N by N matrix is the joint probability of each unit being in the control condition with every other unit being in the treated condition. The second N rows are the same, with the joint probability of each unit being in the treated condition first with each unit being in the control (first N columns) and then with each unit being in the treated as well (second N columns).</p>
<p>We also provide helper functions to build this matrix from any given permutation of treatments (`condition.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Generate 500 arbitrary permutations</span>
permutes &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="kw">rbinom</span>(<span class="kw">nrow</span>(dat) <span class="op">*</span><span class="st"> </span><span class="dv">500</span>, 
                          <span class="dt">size =</span> <span class="dv">1</span>, 
                          <span class="dt">prob =</span> <span class="fl">0.5</span>), 
                   <span class="dt">nrow =</span> <span class="kw">nrow</span>(dat))
<span class="kw">dim</span>(permutes)
permutes[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>]

<span class="co"># Get condition probability matrix</span>
arb_pr_mat &lt;-<span class="st"> </span><span class="kw"><a href="../reference/permutations_to_condition_pr_mat.html">permutations_to_condition_pr_mat</a></span>(permutes)

<span class="kw"><a href="../reference/horvitz_thompson.html">horvitz_thompson</a></span>(y <span class="op">~</span><span class="st"> </span>z, 
                 <span class="dt">data =</span> dat, 
                 <span class="dt">condition_pr_mat =</span> arb_pr_mat)</code></pre></div>
</div>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<div id="refs" class="references">
<div id="ref-aronowmiddleton2013">
<p>Aronow, Peter M, and Joel A Middleton. 2013. “A Class of Unbiased Estimators of the Average Treatment Effect in Randomized Experiments.” <em>Journal of Causal Inference</em> 1 (1): 135–54. <a href="https://doi.org/10.1515/jci-2012-0009" class="uri">https://doi.org/10.1515/jci-2012-0009</a>.</p>
</div>
<div id="ref-freedman2008">
<p>Freedman, David A. 2008. “On Regression Adjustments in Experiments with Several Treatments.” <em>The Annals of Applied Statistics</em>. JSTOR, 176–96. <a href="https://doi.org/10.1214/07-AOAS143" class="uri">https://doi.org/10.1214/07-AOAS143</a>.</p>
</div>
<div id="ref-lin2013">
<p>Lin, Winston, and others. 2013. “Agnostic Notes on Regression Adjustments to Experimental Data: Reexamining Freedman’s Critique.” <em>The Annals of Applied Statistics</em> 7 (1). Institute of Mathematical Statistics: 295–318. <a href="https://doi.org/10.1214/12-AOAS583" class="uri">https://doi.org/10.1214/12-AOAS583</a>.</p>
</div>
<div id="ref-pustejovskytipton2016">
<p>Pustejovsky, James E, and Elizabeth Tipton. 2016. “Small Sample Methods for Cluster-Robust Variance Estimation and Hypothesis Testing in Fixed Effects Models.” <em>Journal of Business &amp; Economic Statistics</em>. Taylor &amp; Francis. <a href="https://doi.org/10.1080/07350015.2016.1247004" class="uri">https://doi.org/10.1080/07350015.2016.1247004</a>.</p>
</div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#estimators">Estimators</a><ul class="nav nav-pills nav-stacked">
<li><a href="#lm_robust"><code>lm_robust</code></a></li>
      <li><a href="#lm_lin"><code>lm_lin</code></a></li>
      <li><a href="#difference_in_means"><code>difference_in_means</code></a></li>
      <li><a href="#horvitz_thompson"><code>horvitz_thompson</code></a></li>
      </ul>
</li>
      <li><a href="#references">References</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright" style="flex:3;">
  <p>Developed by Graeme Blair, Jasper Cooper, Alexander Coppock, Macartan Humphreys, Luke Sonnet.</p>
  <p>Code is licensed under <a href="https://opensource.org/licenses/mit-license.php">MIT</a> license.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
